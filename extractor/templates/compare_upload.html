{% extends 'base.html' %}

{% block title %}Update File Review{% endblock %}

{% block content %}
<div class="header-logout">
    {% if user.is_authenticated %}
        Welcome, {{ user.username }} | <a href="{% url 'logout' %}">Logout</a>
    {% endif %}
</div>

<form id="upload-form" action="{% url 'compare_pdfs_process' %}" method="post" enctype="multipart/form-data">
    <h2>Update File Review</h2>
    {% csrf_token %}

    <div class="file-upload-container" style="grid-template-columns: 1fr 1fr;">
        <div id="file-drop-zone1" class="file-drop-zone required-zone">
            <p class="drop-zone-text"><strong>Revised Report:</strong> Drag & Drop or <span class="browse-link">browse</span></p>
            <span id="file-name1" class="file-name"></span>
        </div>
        <div id="file-drop-zone2" class="file-drop-zone required-zone">
            <p class="drop-zone-text"><strong>Old Report:</strong> Drag & Drop or <span class="browse-link">browse</span></p>
            <span id="file-name2" class="file-name"></span>
        </div>
        <div id="file-drop-zone-html" class="file-drop-zone optional-zone">
            <p class="drop-zone-text">Order Form HTML (Optional):<br>Drag & Drop or <span class="browse-link">browse</span></p>
            <span id="file-name-html" class="file-name"></span>
        </div>
        <div id="file-drop-zone-purchase" class="file-drop-zone optional-zone">
            <p class="drop-zone-text">Purchase Copy (Optional):<br>Drag & Drop or <span class="browse-link">browse</span></p>
            <span id="file-name-purchase" class="file-name"></span>
        </div>
        <div id="file-drop-zone-engagement" class="file-drop-zone optional-zone">
            <p class="drop-zone-text">Engagement Letter (Optional):<br>Drag & Drop or <span class="browse-link">browse</span></p>
            <span id="file-name-engagement" class="file-name"></span>
        </div>
    </div>

    <input id="pdf_file1" type="file" name="pdf_file1" accept="application/pdf" required>
    <input id="pdf_file2" type="file" name="pdf_file2" accept="application/pdf" required>
    <input id="html_file" type="file" name="html_file" accept=".html,.htm">
    <input id="purchase_copy_file" type="file" name="purchase_copy_file" accept="application/pdf">
    <input id="engagement_letter_file" type="file" name="engagement_letter_file" accept="application/pdf">

    <div class="button-container">
        <!-- <a href="{% url 'upload_pdf' %}" class="btn btn-secondary">&larr; Back</a> -->
        <button type="submit" class="btn" style="flex-grow: 1;">Compare Files</button>
    </div>
</form>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    function setupDragAndDrop(dropZoneId, fileInputId, fileNameId) {
        const dropZone = document.getElementById(dropZoneId);
        const fileInput = document.getElementById(fileInputId);
        const fileNameDisplay = document.getElementById(fileNameId);

        if (!dropZone || !fileInput || !fileNameDisplay) {
            return;
        }

        // Open file dialog when drop zone is clicked
        dropZone.addEventListener('click', () => fileInput.click());

        // Add dragover class for visual feedback
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        // Remove dragover class
        ['dragleave', 'dragend'].forEach(type => {
            dropZone.addEventListener(type, () => dropZone.classList.remove('dragover'));
        });

        // Handle dropped file
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                fileNameDisplay.textContent = fileInput.files[0].name;
            }
        });

        // Update file name when selected via browse
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length) {
                fileNameDisplay.textContent = fileInput.files[0].name;
            }
        });
    }

    setupDragAndDrop('file-drop-zone1', 'pdf_file1', 'file-name1');
    setupDragAndDrop('file-drop-zone2', 'pdf_file2', 'file-name2');
    setupDragAndDrop('file-drop-zone-html', 'html_file', 'file-name-html');
    setupDragAndDrop('file-drop-zone-purchase', 'purchase_copy_file', 'file-name-purchase');
    setupDragAndDrop('file-drop-zone-engagement', 'engagement_letter_file', 'file-name-engagement');
});
</script>
{% endblock %}