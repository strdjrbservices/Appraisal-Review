{% extends 'base.html' %}

{% block title %}Verify Report vs. Order Form{% endblock %}

{% block content %}
<div class="header-logout">
    {% if user.is_authenticated %}
    Welcome, {{ user.username }} | <a href="{% url 'logout' %}">Logout</a>
    {% endif %}
</div>

<form id="upload-form" action="{% url 'compare_html_pdf_process' %}" method="post" enctype="multipart/form-data">
    <h2>Verify Report with Order Form</h2>
    <p style="margin-top:-1rem; margin-bottom: 2rem; color: #6b7280;">Upload an appraisal PDF and its corresponding HTML
        export to verify data consistency.</p>
    {% csrf_token %}

    <div class="file-upload-container">
        <div id="file-drop-zone1" class="file-drop-zone">
            <p class="drop-zone-text"><strong>Appraisal PDF:</strong> Drag & Drop or <span
                    class="browse-link">browse</span></p>
            <span id="file-name1" class="file-name"></span>
        </div>
        <div id="file-drop-zone2" class="file-drop-zone">
            <p class="drop-zone-text"><strong>HTML Report:</strong> Drag & Drop or <span
                    class="browse-link">browse</span></p>
            <span id="file-name2" class="file-name"></span>
        </div>
    </div>

    <input id="pdf_file" type="file" name="pdf_file" accept="application/pdf" required>
    <input id="html_file" type="file" name="html_file" accept=".html,.htm" required>

    <div class="button-container">
        <!-- <a href="{% url 'upload_pdf' %}" class="btn btn-secondary">&larr; Back</a> -->
        <button type="submit" class="btn" style="flex-grow: 1;">Verify Data</button>
    </div>
</form>

{% endblock %}

{% block extra_js %}
<script>
    // Re-using the same JS from the other compare page for drag-and-drop functionality
    document.addEventListener('DOMContentLoaded', function () {
        function setupDragAndDrop(dropZoneId, fileInputId, fileNameId) {
            const dropZone = document.getElementById(dropZoneId);
            const fileInput = document.getElementById(fileInputId);
            const fileNameDisplay = document.getElementById(fileNameId);
            if (!dropZone || !fileInput || !fileNameDisplay) { return; }
            dropZone.addEventListener('click', () => fileInput.click());
            dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
            ['dragleave', 'dragend'].forEach(type => { dropZone.addEventListener(type, () => dropZone.classList.remove('dragover')); });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    fileNameDisplay.textContent = fileInput.files[0].name;
                }
            });
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length) { fileNameDisplay.textContent = fileInput.files[0].name; }
            });
        }
        setupDragAndDrop('file-drop-zone1', 'pdf_file', 'file-name1');
        setupDragAndDrop('file-drop-zone2', 'html_file', 'file-name2');
    });
</script>
{% endblock %}